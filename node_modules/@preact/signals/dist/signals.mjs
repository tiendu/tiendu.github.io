import{Component as i,options as t,isValidElement as n,Fragment as e}from"preact";import{useMemo as o,useState as f,useRef as r,useEffect as u}from"preact/hooks";import{effect as s,Signal as c,computed as l,signal as d,batch as a}from"@preact/signals-core";export{Signal,batch,computed,effect,signal,untracked}from"@preact/signals-core";let h,p,w,m=[],v=[];s(function(){h=this.N})();function y(i,n){t[i]=n.bind(null,t[i]||(()=>{}))}function _(i){if(w)w();w=i&&i.S()}function g({data:i}){const t=useSignal(i);t.value=i;const[e,f]=o(()=>{let i=this,e=this.__v;while(e=e.__)if(e.__c){e.__c.__$f|=4;break}const o=l(()=>{let i=t.value.value;return 0===i?0:!0===i?"":i||""}),f=l(()=>!Array.isArray(o.value)&&!n(o.value)),r=s(function(){this.N=F;if(f.value){const t=o.value;if(i.__v&&i.__v.__e&&3===i.__v.__e.nodeType)i.__v.__e.data=t}}),u=this.__$u.d;this.__$u.d=function(){r();u.call(this)};return[f,o]},[]);return e.value?f.peek():f.value}g.displayName="ReactiveTextNode";Object.defineProperties(c.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:g},props:{configurable:!0,get(){return{data:this}}},__b:{configurable:!0,value:1}});y("__b",(i,t)=>{if("function"==typeof t.type&&"undefined"!=typeof window&&window.__PREACT_SIGNALS_DEVTOOLS__)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();if("string"==typeof t.type){let i,n=t.props;for(let e in n){if("children"===e)continue;let o=n[e];if(o instanceof c){if(!i)t.__np=i={};i[e]=o;n[e]=o.peek()}}}i(t)});y("__r",(i,t)=>{if("function"==typeof t.type&&"undefined"!=typeof window&&window.__PREACT_SIGNALS_DEVTOOLS__)window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(t);if(t.type!==e){_();let i,n=t.__c;if(n){n.__$f&=-2;i=n.__$u;if(void 0===i)n.__$u=i=function(i){let t;s(function(){t=this});t.c=()=>{n.__$f|=1;n.setState({})};return t}()}p=n;_(i)}i(t)});y("__e",(i,t,n,e)=>{if("undefined"!=typeof window&&window.__PREACT_SIGNALS_DEVTOOLS__)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();_();p=void 0;i(t,n,e)});y("diffed",(i,t)=>{if("function"==typeof t.type&&"undefined"!=typeof window&&window.__PREACT_SIGNALS_DEVTOOLS__)window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent();_();p=void 0;let n;if("string"==typeof t.type&&(n=t.__e)){let i=t.__np,e=t.props;if(i){let t=n.U;if(t)for(let n in t){let e=t[n];if(void 0!==e&&!(n in i)){e.d();t[n]=void 0}}else{t={};n.U=t}for(let o in i){let f=t[o],r=i[o];if(void 0===f){f=b(n,o,r,e);t[o]=f}else f.o(r,e)}}}i(t)});function b(i,t,n,e){const o=t in i&&void 0===i.ownerSVGElement,f=d(n);return{o:(i,t)=>{f.value=i;e=t},d:s(function(){this.N=F;const n=f.value.value;if(e[t]!==n){e[t]=n;if(o)i[t]=n;else if(n)i.setAttribute(t,n);else i.removeAttribute(t)}})}}y("unmount",(i,t)=>{if("string"==typeof t.type){let i=t.__e;if(i){const t=i.U;if(t){i.U=void 0;for(let i in t){let n=t[i];if(n)n.d()}}}}else{let i=t.__c;if(i){const t=i.__$u;if(t){i.__$u=void 0;t.d()}}}i(t)});y("__h",(i,t,n,e)=>{if(e<3||9===e)t.__$f|=2;i(t,n,e)});i.prototype.shouldComponentUpdate=function(i,t){const n=this.__$u,e=n&&void 0!==n.s;for(let i in t)return!0;if(this.__f||"boolean"==typeof this.u&&!0===this.u){const i=2&this.__$f;if(!(e||i||4&this.__$f))return!0;if(1&this.__$f)return!0}else{if(!(e||4&this.__$f))return!0;if(3&this.__$f)return!0}for(let t in i)if("__source"!==t&&i[t]!==this.props[t])return!0;for(let t in this.props)if(!(t in i))return!0;return!1};function useSignal(i,t){return f(()=>d(i,t))[0]}function useComputed(i,t){const[n,e]=o(()=>{const n=d(i);return[n,l(()=>n.value(),t)]},[]);p.__$f|=4;n.value=i;return e}const k="undefined"==typeof requestAnimationFrame?setTimeout:function(i){const t=()=>{clearTimeout(n);cancelAnimationFrame(e);i()},n=setTimeout(t,35),e=requestAnimationFrame(t)},q=i=>{queueMicrotask(()=>{queueMicrotask(i)})};function A(){a(()=>{let i;while(i=m.shift())h.call(i)})}function T(){if(1===m.push(this))(t.requestAnimationFrame||k)(A)}function x(){a(()=>{let i;while(i=v.shift())h.call(i)})}function F(){if(1===v.push(this))(t.requestAnimationFrame||q)(x)}function useSignalEffect(i,t){const n=r(i);n.current=i;u(()=>s(function(){this.N=T;return n.current()},t),[])}export{useComputed,useSignal,useSignalEffect};//# sourceMappingURL=signals.mjs.map
